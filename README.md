# Provenance-Based Log Analysis

## Table of Contents

- [Overview](#overview)
- [Project Description](#project-description)
- [Problem Statement](#problem-statement)
- [Approach](#approach)
- [Objective](#objective)
- [Target Audience](#target-audience)
- [Installation & Usage](#installation--usage)
  - [Installation](#installation)
  - [Usage](#usage)
- [Results](#results)
- [Technologies Used](#technologies-used)
- [Contributors](#contributors)
- [License](#license)

## Overview

This project demonstrates a provenance-based log analysis system using the Industrial Internet of Things (IIoT). It applies data provenance techniques to detect anomalies or malicious nodes in a network of IIoT devices such as sensors, controllers, and robotic arms, by comparing legitimate and malicious log files.

## Project Description

The system collects logs from IIoT devices involved in a typical use case, where sensors publish MQTT messages, controllers subscribe to those messages and generate alerts based on predefined thresholds, and robotic arms perform actions in response to alerts. By tracking data provenance, we can monitor the flow of data and detect any tampering or malicious activity.

The project has two key log files:
- `legit_logs.json`: Logs from legitimate IIoT operations.
- `malicious_logs.json`: Logs from potentially malicious operations.

## Problem Statement

In the context of IIoT, a compromised node can lead to severe consequences, as malicious devices could send fake sensor data, trigger false alarms, or even control robotic systems. The challenge is to detect and alert system administrators of any suspicious activities by comparing log files with the expected data provenance.

## Approach

1. **Data Provenance Tracking**: The system tracks data provenance by defining legitimate data flow paths (e.g., sensor to controller to robotic arm).
2. **Provenance Comparison**: Logs generated by the IIoT devices are compared with default provenance models. Any deviations are flagged as potential security threats.
3. **Malicious Activity Detection**: The project includes both legitimate and malicious logs for testing the provenance tracking system. It identifies and flags any anomalies based on log comparison and policy enforcement.

## Objective

The primary goal of this project is to use provenance-based techniques to detect malicious activity within an IIoT environment. The project enables users to:
- Create and enforce security policies.
- Monitor log provenance and compare it with the default expected provenance.
- Detect suspicious activities in real-time and issue alerts when necessary.

## Target Audience

This project is aimed at:
- Researchers and developers working on IoT and IIoT security.
- Industrial automation professionals interested in monitoring IIoT systems.
- Anyone looking to implement provenance-based data security in IIoT environments.

## Installation & Usage

### Installation

To install and set up the project, follow these steps:

1. Clone the repository:
    ```bash
    git clone https://github.com/yourusername/provenance-based-log-analysis.git
    ```

2. Navigate to the project directory:
    ```bash
    cd provenance-based-log-analysis
    ```

3. Create and activate a virtual environment:
    ```bash
    python3 -m venv venv
    source venv/bin/activate  # On Windows use: venv\Scripts\activate
    ```

4. Install the dependencies:
    ```bash
    pip install -r requirements.txt
    ```

5. Install the required fonts for image generation (PIL's ImageFont):
    ```bash
    sudo apt-get install ttf-dejavu
    ```

### Usage

1. Run the project by executing the `main.py` script:
    ```bash
    python main.py
    ```

2. You will be prompted with a menu:
    - Select "1" for log detection and provenance comparison.
    - Select "2" for policy creation and enforcement.
    - Select "3" to exit the program.

3. To test with legitimate or malicious logs, provide the file name (`legit_logs.json` or `malicious_logs.json`), and the system will compare the logs with the default provenance model.

## Results

- **Provenance-Based Detection**: The system successfully compares logs and detects any deviations from the default provenance model.
- **Policy Enforcement**: You can create and enforce custom policies based on allowed ports, and the system will check if the logs comply with those policies.

### Example Outputs

- Legitimate logs:  
  `ðŸš© SUCCESS: Logs are not malicious`

- Malicious logs:  
  `ðŸš© ALERT: Logs are malicious`

The system also generates visual representations of the provenance graph for easier analysis.

## Technologies Used

- **Python**: Core language used for implementing the system.
- **PyProv**: For handling provenance documents and generating provenance graphs.
- **PIL (Pillow)**: For displaying image results and captions.
- **MQTT**: Protocol for communication between IIoT devices (sensor, controller, robotic arm).
- **JSON**: Format for log files.

## Contributors

- **Ujjwal Saini** - Developer and Maintainer
